% !Mode:: "TeX:UTF-8"

\chapter{绪论}
\section{研究背景和研究意义}
互联网自诞生以来就在全球迅速蔓延。
2017年根据我国工业与信息化部门发布的最新通信业经济运行情况显示，
2月末，我国全国移动电话用户的总数已经达到13.3亿户，而移动互联网手机用户总数达到11.2亿户，在我国，使用手机上网的用户接近10.6亿户。
而且互联网用户的数量还有很大的增长空间，特别是互联网不怎么发达的发展中国家。同时，智能手机的快速发展使得移动用户的体验越来越好，使移动互联网更加迅速发展。随着移动互联网的发展
出现了各种各样的基于互联网的应用服务，从传统的媒体门户网站
到BBS以及近年来移动聊天的发展，到发展迅速的电子商务网站，还有各种各样的手机移动互联网应用程序。

随着移动互联网和移动互联网应用的发展，数据存储的需求一直在的不断增长。
IDC陈诉显示，估计到2020年全球数据总量将超过40ZB，
这一数据量是2011年的22倍。在过去的几年，全球的数据量以每年百分之58的速度快速增长，
在未来这个速度还会更快。假如按照现在存储容量每年百分之40的增长速度计算，
预计到2020年需要存储的数据量甚至会大于存储设备的总容量。

移动互联网应用的快速发展，伴随着对存储需求的扩大，已经对现在的存储技术的发展带来了很大的压力。很多应用程序的发展需要解决的问题是，如何存储快速增长的用户和应用程序数据。在互联网搜索服务中，需要存储数以万计的网页数据，并加以分析和存储；微博应用中，随着用户数量的增长，需要存储越来越多的数据，而且还要以实时的速度进行处理；在线旅游网站则需要存储全部各地旅游地点的信息，包括各种图片和视频，对存储的需求越发厉害；各种银行则需要存储用户帐户信息和用户信息
用于实时存储和查询。这样应用程序的发展都离不开数据的存储，随着用户数量增长和应用的快速发展，对存储系统产生了新的需求。在这样的
环境下，传统关系数据库并不能很好的满足现在这些移动应用程序的数据库存储技术的需求。

为了解决传统关系型数据的问题，出现了各种各样的非关系型数据库系统，在非关系型数据库中，数据库不再满足强一致性和事务要求，更加重视可扩展性和性能的需求，更加适合大数据应用场景特别是非关系型数据的存储
和管理需求。在刚过去的几年，非关系型数据库得到了前所无有的发展，出现了各种各样的非关系型数据库系统。非关系型数据库是为了解决现在大数据时代非结构化数据存储的问题而产生的。

非关系型数据库具有很多传统关系型数据库所不具备的优点，非关系型数据库抛弃了关系型数据库中严格的事务和强一致性要求，存储的一般都是没有关系的非结构化数据，所以非关系型数据库更加容易在分布式环境下部署。非关系型数据库没有关系型数据库固有的关系模型，存储的数据不局限于关系型结构化数据，使得更加容易使用。非关系型数据库不必要求强一致性和分布式事务，所以在分布式环境下，更加容易扩展，更加适应大数据的存储和处理。这些特点都使得非关系型数据库变得越来越流行，使用的公司越来越多。
虽然新型非关系型数据库在大数据量的存储和处理上有很大的优势，
但是关系数据库在很多关键领域又是无可替代的，
所以如何结合关系型数据库和非关系型数据库的优点成为当前数据库领域的关键问题。

基于移动互联网的快速发展对数据存储的需求，需要开发一种能结合关系型数据库和非关系型数据库的优点，能同时满足应用开发的便利性和应用程序对数据存储的高性能需求。
如何将关系数据库技术，非关系数据库技术
和分布式技术的优点相集合来开发一个新的分布式数据库具有极现实的意义。相对于传统的关系型数据库，这样的数据库结合分布式非关系型数据库的优点，能更加容易的部署在集群环境下，能更加容易存储大量的结构化数据；相对于非关系型数据库，这样的数据库结合了关系型数据库的优点，兼容SQL接口，能存储结构化数据，更加容易满足传统应用程序的开发需求。本文设计和实现的分布数据库系统(以下简称JSQL)就是一种将分布式非关系数据库技术和关系
数据库技术相结合的系统，一旦JSQL开发和部署成功以后，将会给系统和软件平台带来以下好处：

\begin{enumerate}
	\item 结合关系数据库和NoSQL的优点
\end{enumerate}

	JSQL分布式数据库系统是一种将非关系型数据技术和关系数据库技术相结合的系统，首先，它有Nosql系统的优点，能够处理非常大的数据，有很好性能和可扩展性。然后，JSQL作为关系数据库系统，能
	满足应用程序的开发要求，为应用程序提供SQL接口，提供关系操作和事务支持。提供的SQL接口让所有数据库管理员能快速入手操作数据库，提高数据库开发效率。
	
	\begin{enumerate}[resume]
		\item 提高数据库系统资源使用效率
	\end{enumerate}

	JSQL分布式数据库系统具有负载均衡功能，实现了分布式动态负载均衡算法，能根据当前系统的负载信息状态，将客户端的请求路由到正确的分布式数据库节点上面去，能均衡利用分布式集群系统中的数据库的处理能力。采用分布式的负载均衡算法，所有分布式集群中的机器都能参加到整个算法中来，每个集群节点都能成为分布式管理节点来实现分布式负载均衡算法，这样就能避免单点故障问题。通过实现动态负载均衡算法，分布式数据库系统的资源能均衡使用，提高了系统中各种网络和存储资源的高效利用。
	
	\begin{enumerate}[resume]
		\item 提高系统的访问效率
	\end{enumerate}

	本文设计的分布式系统能为客户端选择最合适的分布式数据库节点，这样能就够提高前端客户端的效率，使得其能更加高效的访问分布式数据库的资源。系统为客服端选择最近的节点，同时也节约了系统的网络资源。
	
	\begin{enumerate}[resume]
		\item 提高系统的可扩展性
	\end{enumerate}

	本文设计的分布式数据库系统，其分布式数据库节点集群采用无主服务器设计，能动态
	的增加节点，而不需要用户任何的配置。在动态扩展能力的前提下，当我们需要增加分布式系统的整体存储和性能时，只需要在当前分布式集群中增加一台计算机节点，就比如淘宝双十一的时候需要暂时增加系统的处理能力，就可以动态增加节点。而当数据库的存储需求降低时，只需要减少分布式数据库的节点就能动态的减少系统的资源。提高系统的使用效率。这种可以动态增加和减少系统节点的能力使得系统可以弹性扩展。
	
	\begin{enumerate}[resume]
		\item 提高系统可移植性
	\end{enumerate}

	本文设计和实现的分布式数据库系统全套代码由JAVA语言实现，而JAVA是跨平台的开发语言，所以用JAVA语言开发的分布式系统JSQL能够部署到更广泛的平台上。使得分布式数据库系统可以在不同的平台上迁移和移植。
	
	\begin{enumerate}[resume]
		\item 内置数据库安全审计功能
	\end{enumerate}

	数据的重要性越来越重要，如何保证数据库的安全性是现在急切需要解决的问题，如何防止用户随意篡改数据在系统的设计上作为一个重要的功能需求。JSQL从数据库底层实现了数据库的审计功能，提供比其他方法更高的性能。管理员通过管理客户端能够监视数据库系统的运行状态，能监控数据的更改情况。
\section{数据库历史与现状}
数据库技术在20世纪60年代开始出现。在没有数据库技术的时候，使用系统的用户主要是用操作系统的文件存储数据。但是文件存储有太多的缺点，比如不容易在不同应用程序之间共享，这就使得数据库的出现。从60年代开始，出现了各种各样的数据库，其建立在不同的数据模型下，其中最有名的是层数据模型，网格数据模型，对象数据模型和关系数据模型。其中关系数据模型建立在严格的关系代数理论之上，具有数据独立性更高等优点而变得越发流行。从20世纪70年代到90年代开始，关系数据库的理论逐渐成熟并得到广泛应用，
关系数据库发展的里程碑发送在1974年，IBM的研究员开发了SEQUEL结
结构化查询语言，这样语言后来在1980年更名为SQL。SQL是关系数据库中的标准数据查询
语言，在1986年，由美国国家标准学会规范SQL，就这样成为了
数据库系统的标准语言。 SQL包括数据定义和数据操作等语言，使用这种语言不需要用户具有数据库和计算机程序设计相关的知识，这使得其在数据库管理人员中变得越来越流行，如今，每个数据库管理员都基本掌握这种数据操作语言。在90年代以后，关系型数据库在企业中成为标准，其操作语言的很多优点，使得其更加容易使用，容易被企业数据管理人员所接受。

分布式数据库系统是部署在网络中多台计算机中的数据库系统，其结合现在的互联网网络技术和数据库技术，使得数据库的存储能力在分布式环境下得到了极大的增强。分布式数据库技术的发展开始的很早，但是分布式系统在企业中的应用还是20世纪90年代的事情。
因为在90年代以后，互联网才进入高速的发展，对数据存储的需求得到了爆发的增长。在互联网的快速发展下，分布式数据库系统在市面上出现了，在这其中出现了各种各样的分布式理论，这又促进了分布式数据库系统的发展。 在2002，美国有学者提出了CAP理论，CAP理论认为，在分布式数据库系统中，不可能同时满足CAP3个条件，这三个条件分别是一致性，可用性和分区容忍性。 基于CAP理论，分布式数据库系统不可能同时满足一致性，可用性和分区容忍性。根据CAP理论的指导，我们知道，传统的关系型数据库系统不能很好的满足现状分布式数据库的需求，因为现状分布式系统的发展是为了存储大容量数据而产生的。但是在关系型数据库中，其满足必须满足强一致性，所以分布式关系型数据库系统是不能再同时满足可用性和分区容忍性的。为了满足大数据量的存储，出现了很多非关系型数据库系统。

在二十一世纪以后，移动应用存储的快速发展，导致了非关系型数据库的出现。
和关系型数据库不同的是，非关系型数据库抛弃了强一致性，所以根据CAP理论，其可以同时满足可用性和分区容忍性，这样就使得非关系型数据库系统更加容易部署到分布式的环境下，使得其更加适合存储大量的数据。 非关系型数据库不支持强一致性，不支持强事务。因为抛弃了强一致性
非关系型数据库支持高可用性和分区容忍性，使得其更加容易使用。在CAP理论出现以后，出现了很多非关系型系统，这些系统因为抛弃了强一致性，所以其可用性和性能都比传统的关系型数据库得到了很大的提高。特别使用很多不需要事务和强一致性的应用程序的需求，就比如现在的贴吧和微信的互联网应用，其得事务没有要求。在这些应用中，用户数据的丢失和错误并不会产生很大的影响。


在过去几年，随着移动互联网的告诉发展对数据存储的需求提高，分布式非关系型数据库得到了广发的使用，同时，CAP理论也证明了它的正确性。
非关系型数据库抛弃了对强一致性的支持，非关系型数据库可以应用到对数据的强一致性和对事物不高的应用程序上面。但是，那些对强一致性和事物有要求的应用，比如
电子商务，就不能使用非关系型数据库，因为其对事物有严格的要求，用户数据要保证正确和保证强一致性。但是，这些应用也发展的毕竟快，对大数据量的存储需求也在提高，所以如何存储这种数据成了一种新的挑战。要满足大数据量的存储，必须要部署在分布式的环境下，其就必须要满足可用性和分区容忍性，但是根据CAP理论，满足了可用性和分区容忍性，就不能满足一致性。不能满足一致性对电子商务这样的应用就不能使用。所以现在的做法是尽量减少可用性和一致性，来开发新的分布式关系型数据库。在之前几年，每个大的公司都对这样的数据库开发提高了兴趣，这种数据库不但要满足关系型数据库的强一致性和事物的需求，还要部署在分布式环境下，满足对大数据存储的要求。
下面对对目前市面上比较有代表性的分布式关系数据库系统进行简单的介绍。
这些系统就是为了克服关系型数据库的缺点，同时能部署在分布式环境下存储大数据量结构化数据的分布式数据库。

\begin{enumerate}
	\item Google Spanner
\end{enumerate}

	Spanner 是一个可扩展的、全球分布式的数据库，是在谷歌公司设计、开发和部署的。
	
	在最高层面，Spanner就是一个分布式数据数据库，其将数据存储在分布式环境下的很多台计算机上，这些机器被部署在全球各地。在这个分布式数据库中，通过分片的复制，满足了数据的可用性。当一个副本失败以后，其他节点会自动恢复副本。在系统中，分布式系统会自动的将用户存储的数据进行分片，然后复制存储到不同的计算机节点。Spanner是可以扩展到几百万个机器节点的全球分布式数据库，其跨越成百上千个数据中心，可以存储几万亿数据。
	
	通过在每个不同的洲之间复制数据，可以保证，即使发生特大的自然灾害，存储在分布式数据库系统中的数据依然是可以用的。
	作为一个全球分布式关系数据库，Spanner 提供了很多有趣的特性。应用程序可以对存储在分布式数据库中的数据副本进行详细的配置。应用可以详细规定，哪些数据存储在哪些分区，哪个洲，不同的数据副本保存在什么节点上，同时能设计，在副本失效的时候，从什么地方恢复。分布式数据库也可以在不同的分布式机器之间来回迁移数据，达到资源更加平衡的使用。作为一个分布式的数据库，其不但保证了每个数据分配的强一致性，而且通过原子操作，实现了分布式的事务。
	
	\begin{enumerate}[resume]
		\item 阿里巴巴OceanBase
	\end{enumerate}
	
	
	OceanBase是一个阿里巴巴开发的支持海量数据存储的高性能分布式数据库系统，能存储了数千亿条记录，支持数据上的跨行跨表事务，由阿里巴巴的淘宝各部门联合开发。在设计和实现OceanBase的时候阿里巴巴暂时抛弃了数据库系统中不紧急的功能，例如临时表和视图，阿里巴巴研发团队把有限的资源集中到关键功能的开发商，当前 OceanBase主要解决数据更新一致性和高性能的跨表读事务等功能上。
	
	OceanBase已经实现了商用，其应用于淘宝收藏夹应用程序中，用于存储淘宝用户的收藏条目和具体的商品和店铺信息，每天支持成千上万的更新操作。等待上线的应用还包括其他很多阿里巴巴内部和外部的应用程序中，每天更新的数据量超过20亿，更新数据量更是超过2.5TB。
	
	OceanBase设计和实现的时候抛弃了很多不关键的数据库功能，使得其能很快的应用于生成实践中，而且根据CAP理论，在满足可用性和分区容忍性的时候，对强一致性要求必须要选择抛弃，阿里巴巴根据自身应用的特点，对不关键的功能进行了选择的抛弃。
	\begin{enumerate}[resume]
		\item 微软SQL Azure
	\end{enumerate}
	
	
	SQL Azure 是微软开发的部署在云上的分布式关系数据库系统，为应用程序提高分布式的存储服务。其主要部署在windows操作系统之上，为企业用户提高服务。
	
	SQL Azure提供了一个功能强大且为人熟知的存储结构，很多传统关系型系统的功能在这上面得到了支持。SQL Azure是一个云数据库系统，将数据存储基础结构托管在云上，大大地降低了企业在IT方面的资源投入。企业用户按需付费使用分布式关系数据库，不用自己维护分布式数据库的部署，不用自己管理系统。
	
	数据在企业中的变得越来越重要，所以要确保数据的安全，同时也要确保数据的高可用性，这样才能满足现在企业应用发展的需要。SQL Azure完美的支持可用性，当用SQL Azure进行数据的增删改的时候， SQL Azure会自动地将数据备份到若干节点，以保证数据的高可用性;SQL Azure后台内置的集群机制完美保证了对自动故障转移的支持，而且无需人工监守。
\section{论文的主要工作}
在学习了有关关系型数据和非关系型数据库的有关理论和技术以后，
论文作者基于Java语言设计和实现了一个分布式的关系型数据库JSQL
，JSQL结合了非关系型数据库OrientDB和关系型数据库的优点，同时实现了Mysql的通信协议，
是一个兼容Mysqk通信协议的分布式数据库。在系统的实现过程中做的主要工作包括：
\begin{enumerate}[fullwidth,itemindent=2em]
	\item 利用OrientDB非关系型存储引擎设计和实现了关系型数据库的本地存储系统。
	\item 实现了Mysql通信协议，使得可以通过Mysql客服端来连接JSQL分布式数据库，
	方便Mysql用户迁移到本数据库系统。
	\item 实现了对SQL语句的解析和执行，完成对关系数据库接口的支持。
	\item 实现了数据库的分布式架构，使得数据可以存储在多台计算机上面。
	\item 实现了系统的审计系统，使得系统的安全性得到增强。
	\item 设计和实现了分布式负载均衡算法，完成了分布式数据库节点的动态负载均衡功能。
	\item 利用分布式多版本并发控制机制解决了分布式数据一致性问题。
	\item 数据库系统做完以后，对系统进行了各项软件测试，包括功能测试，
	性能测试等，以验证系统是否满足需求，达到了系统设计的目标。
\end{enumerate}
\section{本论文的结构安排}
第一章是论文的绪论，在这一章中，介绍了论文的选题背景和本论文进行研究的意
义。然后阐述了关系数据库和非关系型数据库的发展历史和现状，对当前几个流行的分布式数据库系统进行了简单的介绍。在最好一节，对论文的主要工作进行了阐述。

第二章，主要介绍了本论文相关的理论基础和相关的技术。这一掌首先对数据库系统方面的理论知识进行了说明，包括数据库系统和关系数据库系统的概念，简单的讨论了NoSQL数据库系统；然后简单介绍了分布式数据库相关理论，
对分布式系统中数据库分布式和数据复制技术进行了介绍。最后介绍了一种新的分布式动态负载均衡算法和分布式MVCC技术，这些算法和技术将会在系统的实现了作为重要的理论基础。

第三章，作为分布式系统JSQL的分析。本章首先给出分布式数据库JSQL的实现目标，并对系统进行了详细的需求分析。
从分布式数据库的使用者角度出发，
对分布式数据库JSQL进行详细和切合实际的需求分析，在对系统进行需求分析以后，
对分布式数据库的整体架构等进行模块划分。根据每个模块的作用，对每个模块的功能进行再划分。
然后本章对重要的模块进行了分析，包括对各种技术和框架的选择，详细说明了实现分布式数据库系统需要用到的各种技术。

第四章，作为分布式数据库系统的设计部分，本章包括JSQL的总体设计和模块划分，本章对系统的总体架构和各个模块的详细架构给出了阐述。
系统主要包括分布式管理节点和分布式数据库节点。本章对分布式管理节点和分布式数据库节点的各个模块进行了详细的分析。

第五章，是关于系统的具体实现。根据第四章的总体设计和详细设计，本章对设计部分划分的关键模块的实现进行了说明，
重点对分布式管理节点和分布式数据库节点功能的实现进行阐述，对论文中使用到的关键算法和技术，用流程图对其进行说明。

第六章，作为系统的测试部分，本章对论文中的jsq分布式数据库进行了测试，测试包括功能测试和性能测试。

第七章，论文总结了论文所做的工作，对本系统的优点和不足进行了说明。并对未来的工作进行了展望。

最后部分，是关于致谢和参考资料。