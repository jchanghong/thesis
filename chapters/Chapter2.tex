% !Mode:: "TeX:UTF-8"

\chapter{相关理论和技术}
本章介绍数据库和分布式系统有关的概念和理论，以及本系统所涉及到的关键算法。
\section{数据库系统}
\subsection{数据库系统概念}
数据库系统就是一种管理数据库的软件，其一般建立在操作系统之上，为应用程序和用户提高操作接口。在数据库系统之前，应用程序用文件存储应用程序数据,这有很多缺点，首先，不同的应用程序就有不同的格式，存储的文件不能在不同的应用程序之间共享；然后，用文件存储应用程序数据不能在多应用程序之间并发执行程序，因为操作系统为了保证文件的安全，一般需要应用程序锁定文件，这样就不能让很多线程或者进程去操作应用数据；最后，用文件存储数据不方便应用程序数据格式转化，在应用程序需要更新应用程序数据格式的时候，就非常麻烦。数据库管理系统能很好的避免上面的缺点，其统一管理系统中的所有数据，应用程序通过向数据库系统发生命令来操纵数据，这样保证了数据的安全，更方便数据在不同应用程序之间的共享。

数据库管理系统为应用程序和各种抽象数据提供了一个软件抽象层，应用程序或者用户通过数据库管理系统来操作数据，不需要关心数据的具体物理存储格式，更不需要了解底层磁盘系统如何存储这些数据。
不同的应用程序通过数据库系统可以共享数据，使得数据更加容易更新和维护。在更新数据库管理系统的时候，只要这个管理系统的操作接口和之前的数据库管理系统一样，那么应用程序就不需要做任何的更改就能进行运行，这种抽象为应用程序提供了很大的便利。
\subsection{关系数据库系统}
在数据库系统的发展早期出现了其他多种数据库系统，关系数据库系统因为许多优点从其被发明以后就被用在企业的各种应用之中。关系数据库系统建立在关系模型之上，关系模型以关系代数为理论基础，有严格的数学理论基础。在关系数据库系统中，所有数据都被表示成数学上的关系。关系型数据库系统通过表的结构来存储结构化的数据，其不能很好的存储其他无类型的数据。

在关系数据库系统中，数据存储在表中，一个表代表一种结构化数据类型。表的每列代表这种结构化数据类型中的一个属性，表的每行代表一个这样的结构化数据记录。在数据库管理系统中，数据之间的关系是通过表与表之间的外键相互联系的，而不是在记录中直接存储数据之间的关系。这样的好处是能够减少数据的存储量，在寻找数据的关系数据的时候就需要通过外键遍历其他的表，在表增多的时候，性能就会受到到严重的影响。

关系数据库系统有通用的结构化操作语言SQL，在关系数据库系统中，应用程序和用户通过发送SQL命令来操作数据。SQL操作语言非常容易使用，使用者只需要说明操作目的，而不需要说明操作步骤。关系数据库系统会解析SQL，寻找最优化的执行过程。

关系数据库支持严格的事务，要求事务必须要满足原子性、一致性、隔离性和持久性。这些特性能够保证结构化数据的一致性和安全性，在高并发情况下，关系数据库系统也能保证数据处于一致性的状态。数据一旦存储在关系数据库系统中，就永远持久化存储在磁盘中。
\subsection{事务与并发控制}
\subsubsection{事务}
事务能保证关系型数据库中数据的强一致性和正确性。一个事务表示对数据库系统的一系列的操作，关系型数据库管理系统能保证这些操作的正确执行，而不会破坏数据的完整性。
关系型数据库的事务有两个主要目的：
为了提供一个可靠的工作单元，在这个单元中，允许从故障中正确恢复，并保持数据库在任何情况下都是强一致性的。
即使在系统故障的情况下，关系型数据库也能保证事务的正确完成，避免数据的丢失和数据的不一致。
事务也能在同时访问数据库的程序之间提供必要的隔离，如果没有提供这种隔离性
，程序的执行结果可能是错误的和不可预见的。
根据关系数据库的定义，数据库事务必须是原子的、一致的、隔离的和持久的。
在一个事务执行单元中，所有步骤必须正确完整的执行完成。
此外，关系数据库系统必须将每个事务与其他事务隔离开来
，不然可能会产生不一致性的结果，同时，事务的执行结果必须存储在永久性存储介质中，不能丢失。

数据库完整性是事务的一种重要保证，如果不能保证数据的一致性，那么关系型数据库将是不可靠的。
每个事务都是不同的执行步骤组成，在事务执行过程中，每个步骤要么全部完成，要么全部失败，没有中间结果。
事务的执行必须是可预测的，关系型数据库不准出现不可预测的不一致性的结果，这样数据的完整性不能得到保障，就不能正确的使用数据。
\subsubsection{并发控制}
并发控制在计算机和数据库系统中都是关键技术，操作系统通过并发控制防止硬件和软件资源的错误使用，数据库系统中数据的一致性和正确也需要并发控制技术来保证的。在多并发操作的情况下，如果没有并发控制，多个事务的操作结果是不可预测的，最严重的情况是会产生错误的数据，导致数据的不一致性，这样数据库管理系统就是不可靠的。不管是操作系统和数据库管理系统，其并发算法的执行都需要运行开销，所以如何保证正确性的同时减少系统的开销是数据库系统中重要的话题，所以不同的数据库管理系统都有不同的并发隔离级别，提供给用户选择使用，让用户根据具体场景选择正确的并发控制级别。

并发控制在操作系统和数据库管理系统，或者其他的关键系统中都是正确性的保证。在关系型数据库系统中，不同的事务同时执行时，其结果往往不可预测，如果没有并发控制，数据的正确性也得不到保证。
在不同的关系数据库系统中，其采用的并发控制技术会有所不同，但是总结下来，主要的并发控制方法有如下几种：

	\begin{enumerate}
		\item 锁定
	\end{enumerate}


  锁定是并发控制方法中最重要也是最容易理解的方法，在操作系统和数据库管理系统中都有应用。在关系数据库系统中，多个事务同时访问一个数据库对象，就会产生不一致性的结果。所以我们只需要让事务在访问对象的时候，锁定其访问的对象，这个时候其他事务执行过程中就不能访问，只能等待，最终防止数据不一致性的情况出现。
	
	\begin{enumerate}[resume]
		\item 串行化
	\end{enumerate}

 串行化是最严格的并发控制技术，其开销也是最大的。在这种并发控制方法中，禁止事务并发执行，在这种情况下，不会出现数据错误的情况，但是其性能会非常低下。
 
 \begin{enumerate}[resume]
 	\item 时间戳排序
 \end{enumerate}

  为每个事务分配不同的时间，让其按照不同的时间执行，这样可以防止同时访问数据库的时候产生不同的结果，影响数据的正确性。其和串行化技术是相识的技术。
   
    \begin{enumerate}[resume]
   	\item 承诺排序
   \end{enumerate}

 为不同的事务分配不同的顺序，保证在同一个事务中不可能访问到其他事务的执行结果，防止每个事务的相互影响。这种情况是为了提高并发度，数据库管理系统检查事务的顺序，在保证正确的情况下让事务依次运行。
 
\begin{enumerate}[resume]
	\item 多版本并发控制
\end{enumerate}

通过在每次写入对象时生成新版本的数据库对象，
	并根据调度方式允许事务对每个对象的最
	后相关版本的读取操作来增加并发性和性能，但是这种情况会增加数据存储空间的占用。
	
	\begin{enumerate}[resume]
		\item 索引并发控制
	\end{enumerate}

将访问操作同步到索引，
而不是用户数据。这种专业方法提供了显着的性能提升。

每个事务在执行的时候和其他事务保持隔离，事务执行中间结果不会被其他事务看到，这样才能防止很多数据操作的错误。关系型数据库系统一般会提供多种隔离级别，在最高级别的情况下，能保证数据绝对正确，但是并发性能较低，在最低级别的时候，并发性能最高，但是可能会出现数据的不一致性情况的出现。
\subsection{非关系型数据库系统}
随着移动互联网的快速发展，对数据库系统的要求越来越高，要求能存储海量数据，能支持高并发的移动客户端的访问，关系数据库系统不能支持这些新的要求，所以就出现了很多的非关系型数据库系统。
非关系型数据库系统由于其非常适合很多大型移动互联网网站数据存储，所以近几年得到了高速的发展，在很多互联网公司中都有不同的应用。非关系型数据库系统是在关系型数据库系统成为主流的时候出现的，其要解决关系型数据库所不能解决的问题，比如分布式环境下部署，大量数据的存储，高并发客户端的访问等等。
虽然非关系型数据库的流行还没有多久的时间，但是
不可否认，现在已经对关系型数据库产生了非常大的影响。虽然早期非关系型数据库都比较简单，不过现在很多非关系型数据库已经变得更加成熟，越来越适合现在数据的存储。不过，现在很多非关系型数据库不得不重写，已应对新的存储需求，从一开始，其就缺少很多关系型数据库的特性，虽然其抛弃了很多关系型数据库的特性，使得其在一些方法，比关系型数据库更加适合。但是
关系型数据库系统的很多功能是很多移动互联网应用所必须要满足的，而要满足这些需求，之前的很多非关系型数据库就必须要经过重写。

非关系型数据库并没有准确的定义，也有不同类型的非关系型数据库系统，比如关系模型最简单的键值数据库系统，存储图片和文档等文档数据库系统，还有推荐引擎中的图形数据库系统。在有些应用程序中，甚至也有对象数据库系统。不管有多少非关系数据库系统，其大多都普遍存在下面一些共同特征：
\begin{enumerate}[fullwidth,itemindent=2em]
	\item   无模式数据存储：在非关系型数据库系统中，不需要像关系型数据库系统一样，在存储数据的时候必须要先确定数据的结果和模式，并建立相应的表结构。数据库系统中
	的每条记录都可能会有不同的属性和格式。当插入和修改数据时，并不需要定义它们的存储模式。
\item 	无共享架构：非关系型数据库系统在分布式部署中，其没有共享的架构，存储在分布式集群中不同的存储节点。客户端从最近的网络节点存取数据，比通过网络获取数据能提高系统的性能。
\item 	弹性可扩展：可以在系统运行的时候，动态增加或者删除结点。
不需要停机维护，数据可以自动迁移。
\item 	分区分片：传统的关系型数据库系统大多都是单机数据库系统，其不能很好的在分布式环境下部署，而非关系型数据库已经放弃对复杂事务的支持，其能方便的部署在分布式环境下，数据不存储在单一节点，存储在分布式环境下的多个节点之上。在数据库集群中，不但要对数据进行分区存储，还要对分片进行复制
。这样既提高了数据库系统中的并行性能，又能保证集群系统中没有单点失效的问题。
\item 	异步复制：和很多关系型数据库系统不同的是，非关系型数据库中的复制，
往往就是基于日志的异步复制。异步复制可以让复制更快的完成，不会因为网络原因而阻塞。这样做的缺点是并不总是能保证一致性，而非关系型数据库系统本身就没有保证强一致性，
这样的方式在出现节点故障的时候，就可能会丢失少量的数据，在一些场景下，这并不是很严重的问题。
\item 	BASE：和关系型数据库的强一致性不同，非关系型数据库系统采用的是弱一致性，也就是说，并不能保证数据一定可靠，它只提供必须的一致性，这样就能提高更好的性能。
\end{enumerate}
\subsubsection{Nosql缺点}
虽然NoSQL拥有许多好处，但并非没有缺点。简单的说，非关系型数据库大多有下面这些缺点：
\begin{enumerate}
	\item 技术支持：NoSQL数据库往往是开源项目。当出现问题时，您可能有幸接触到开发人员社区并找到您的答案。不幸的是，今天最强大的企业无法承担那些不够完善，缺乏全面支持的产品。好消息：当今领先的NoSQL公司倾向于提供免费的商业产品以及为倾向于包含企业级支持的组织设计的高级产品。
\item 	不成熟：虽然NoSQL已经存在了相当长的一段时间，但直到最近NoSQL数据库才开始严重侵入现代企业。因此，许多NoSQL解决方案并不像许多组织那么成熟，特别是与RDBMS相比时更是如此，这也是导致出现各种非关系型数据库系统，并不是一家独大。
\item 	不符合ACID：特别是公司和电子商务组织，非常重视所谓的ACID合规性。当数据库可以确保每次交易的原子性、一致性、隔离性和持久性时，它们就被认为符合ACID标准。本质上，ACID合规确保数据库按预期处理事务。虽然许多NoSQL数据库不符合ACID标准，但本论文所选的OrientDB支持基本的事务操作。
\end{enumerate}


OrientDB是一种非关系型数据库系统，虽然它不是关系数据库系统，但是
其底层的存储引擎支持关系型数据库中的事务。所以本系统在后面就直接用的这个存储引擎
减少系统的开发时间，同时也增加系统的稳定性。同时能够结合非关系型存储引擎和关系型数据库功能，能为系统提供更好的实用性。
\section{分布式数据库}
\subsection{分布式数据库概述}
分布式数据库系统也是一个数据库管理系统，只是其管理的数据不存储在单机的计算机主机上面。
分布式数据库系统的数据可以存储在相同位置的多个计算机上面，也可以存储在通过网络互连的多个地区的计算机集群上面。
分布式数据库系统的节点分布在网络上的各个地方，节点之间没有共享物理组件。
分布式数据库相比单机版数据库系统有下面这些特点。
\subsection{分布式数据库的特点}

	\begin{enumerate}
		\item 数据独立性
	\end{enumerate}

	分布式数据库系统中的数据独立性是指，在分布式数据库系统中，集群中的每个节点都独立管理其当前局部数据，就算没有连接互联网，单机情况下，其也能对外提供服务。客户端也能连接这个节点，这个节点为客户端提供本地局部数据操作的能力。分布式数据库系统节点的独立性能够保证系统的高可用性，在分布式系统中，一个节点的失败不会影响到其他的节点，其他节点能正常的为本地客户端提供服务。在分布式数据库系统中，物理位置的独立性和逻辑独立性是两个基本要求，数据物理位置的独立性是指在分布式环境下，数据的位置发现变化的时候，其客户端能保持不变，逻辑独立性是指，在系统的内部存储结构发生变化的时候，分布式数据库系统对面提供的接口保持不变，这样应用程序就可以和系统保持独立变化。
	

	\begin{enumerate}[resume]
		\item 分布透明性
	\end{enumerate}

	在分布式数据库系统中，分布透明性是指，数据库的客户端不需要了解分布式数据库系统中数据存储的具体物理位置，客户端对分布式系统中数据分布的变化不用了解。有了分布式数据库的分布式透明性，当数据库的物理存储位置发生改变时，其数据库用户应用程序不需要知道变化，能进行保持运行。这样就能保证在分布式数据库系统在系统升级和数据迁移时候，上面的应用程序不需要做任何的改变就能适合新的物理架构。这样我们就能从容的改变分布式的物理分布式，而不用担心会影响到应用程序。

	\begin{enumerate}[resume]
		\item 节点自治性
	\end{enumerate}

	节点自治性是指，在分布式数据库系统中，每个分布式数据库节点能够自己管理其本地数据，不需要分布式数据库中其他节点的参与。对于客户端而言，其不必关心连接的是分布式数据库还是分布式数据库中的一个节点。每个数据库节点能够自己管理其中的数据，而且功能和分布式数据库系统本身对外提供的功能一样，这样连接分布式数据库任何节点的客户端，其感受到的功能都是一样的。其所能访问的数据由分布式数据库的所有节点组成，也是一样的。

	\begin{enumerate}[resume]
		\item 复制透明性
	\end{enumerate}

	在分布式数据库系统中，复制技术是为了保证系统数据的安全性和可用性。分布式数据库系统中，通过多个数据副本，为客户端选择最适合的读取路线，选择最适合的副本，有利用提高分布式数据库系统中读取性能。在分布式数据库系统中，数据复制多少份，复制副本如何分布式这些问题都是由分布式数据库系统自动完成的，应用程序不需要关系复制的细节。更简单的说，在分布式数据库系统中，客户端根本就不用感受到副本的存在，副本的复制策略和分布式规则都是由分布式数据库系统自动完成。

	\begin{enumerate}[resume]
		\item 易于扩展性
	\end{enumerate}

	在分布式数据库系统中，可能会遇到系统性能和存储不能达到要求的情况，这样我们就遇到对分布式数据库系统进行扩展。易于扩展性是指在分布式数据库系统中，很容易对系统的整体性能进行扩展，包括对读取和更新性能的扩展，对存储容量的扩展。在最理想的情况下，分布式数据库系统能够动态增加数据库节点，动态扩展系统的性能。在系统需要暂时进行扩展的时候，只需要在分布式数据库节点集群中加入新的主机就可以了。
	\subsection{数据分布和负载均衡}
在分布式数据库系统中，单机服务器不能存储所有的数据，如何把数据分布在分布式环境下的多个服务器上面需要一种数据分布方式。下面将介绍几种不同的数据分布方式。 
\subsubsection{哈希分布}
在分布式系统中，哈希分布是指，分布式系统中的所有数据通过计算关键字的哈希来决定其分布的位置，在具体的实现中，其往往用计算的哈希值和分布式数据库节点中的机器数比较，先为集群中的每个节点分配一个序号，然后用关键字的哈希和总节点数取模，最后用取模的结果和机器序列号做比较。在哈希分布式中,分布式系统需要管理的元信息很少,只需要知道哈希函数和计算机集群中节点个数。 
但是这种方法有个很明显的缺点,那就是其扩展性很差。比如，如果想把集群规模扩大一倍,那么
所有集群中的的数据需要被重新迁移到不同的节点中。一种解决哈希分布扩展性差的问题是引进元数据服务器， 
这种方法的思路是，不再把关键字的哈希值和分布式集群中的分布式节点数取模，而是在元数据服务器中存储数据和
分布式节点之间的对应关系。在获取数据的时候，客户端需要先链接元数据服务器得到分布式数据库节点的地址，然后链接
分布式数据库节点得到具体的数据。
不过，这样一样就需要保存很多的元数据，在分布式集群集群数变得很大时，这样的方法就存储很大的性能问题。
\subsubsection{顺序分布}
除了哈希分布以外，在分布式数据库系统中，也可以按照数据关键字的范围来分配数据，
在这种方法中，首先将数据关键字划分成不同的区间，然后将区间和分布式数据库服务器节点映射。
比如我们可以将用户划分到不同的区间，分区到分布式系统中不同的节点存储。
用数据范围来解决数据的分布式,实现动态划分范围空间,实现负载均衡。 
这样方式分布数据，需要保存什么区间的数据存储到什么数据库节点上面去，这样的信息可以存储在专门的元数据节点服务器中。  
使用这样的分布方式，可以在不同的机器之间迁移数据，而不会影响到过多的分布式数据库节点，而只需要在元数据库服务器中，更新分布式区间和数据库节点之间的对应关系，这是哈希分布式方式所不能做到的。按顺序分布的优点还有，在扩展分布式数据库集群的时候，当增加节点的时候，不需要迁移全部的数据，只需要将新的分区迁移到新的数据库服务器节点就可以完成数据库集群的扩容。
这样的分布方式问题就是需要存储所有的数据分区到数据库节点之间的对应关系，当数据库的容量增加时，元数据可能会成为分布式数据库系统的瓶颈。
\subsubsection{一致性哈希}
一致性哈希的分布式方式是为了克服简单哈希分布的缺点。
在简单哈希分布式中，当增加数据库节点的个数的时候，我们需要迁移非常多的数据。这样就性能系统的扩展时间，影响系统的性能。
在一致性哈希中，分布式数据库节点的哈希值保持在一个圆圈上面。然后根据关键字计算哈希值，在圆圈上面找最接近的哈希值。然后就把这个哈希值对应的数据存储在对应哈希点的分布式数据库节点上。
在增加或者删除数据库节点的时候，只需要迁移相邻分布式节点之间的数据，其他节点的数据可以保持不移动。这样就能提高分布式系统的性能。
使得更加容易扩展其容量和性能。 
\subsubsection{负载均衡}
在分布式数据库系统中，负载均衡是用来平衡各种网络和服务器资源的使用的。通过负载均衡，客户端可以选择合适的服务器来操作分布式数据的存储。避免一些分布式节点因为过载而不能提供服务，避免一些分布式数据节点因为得不到客户端的请求，而浪费分布式系统整体的资源使用率。
通过使用负载均衡，能使系统高效的完成客户端的请求，同时避免资源的浪费。
负载均衡功能可以通过硬件和软件的方式来实现，软件负载均衡是根据不同的负载均衡算法来实现的。
有很多种负载均衡的算法可用，下面是常用的一些算法：



	\begin{enumerate}
		\item 轮询法
	\end{enumerate}

	轮询法可能是是负载均衡算法中最常用最简单的算法，这种算法也很容易理解，同时也容易实现。 
	轮询法是指分布式系统中负载均衡服务器将客户端的请求按顺序
	轮流分配到分布式系统后端服务器节点上，以达到负载均衡后端数据库节点资源的目的。 	

\begin{enumerate}[resume]
	\item 加权轮询法
\end{enumerate}

	简单的轮询法没有考虑分布式系统中每个节点性能的差异，也没有考虑分布式系统节点的当前负载状态，所以不是高效的负载均衡算法。加权轮询法则是考虑了分布式数据库节点中每个节点性能的差异，当客户端连接到来的时候，在为其选择分布式节点的时候，考虑到分布式节点的性能和当前的负载状态。为其选择更适合的分布式数据库节点。

\begin{enumerate}[resume]
	\item 最小连接数法
\end{enumerate}

	最小连接数法也很简单，其根据分布式系统中当前节点的连接数来分配节点。为客户端选择当前连接数最少的数据库节点。这种方法认为，当前连接数最少的服务器节点，其当前的处理能力最强，所以应该分配给客户端。但是这种方法没有考虑到分布式系统中不同节点的性能差异。所以也不是很好的算法。

\begin{enumerate}[resume]
	\item 随机法
\end{enumerate}

	随机法很简单，其利用数学上的概率知识，随机的从分布式节点中选择一个节点。从概率上来说。这样每个分布式节点被分配的几率是一样的。经过系统的运行，每个分布式节点的连接数应该是差不多的。但是这样的算法，同样是没有考虑系统当前的机器负载状态和性能差异。所以也不是很好的算法。
\begin{enumerate}[resume]
	\item 源地址哈希法
\end{enumerate}

	这种算法的想法是，根据客户端的一种信息，一般是网络地址。然后计算哈希值。然后和分布式数据库中节点个数取模。就能得到一个值，然后根据这个值。选择分布式节点。这样的方法。首先需要提前排序好分布式数据库节点顺序，所以当其中一台计算机节点失败的时候，就可能需要重新计算所有的哈希值。影响之前的分配。所以这样的方式也不是好的分配算法。
	
	好的负载均衡算法影响是动态的负载均衡算法，其能考虑到不同的分布式节点的性能差异，同时能考虑到当前每个节点的负载信息。这样就能正确的分配的分布式节点。本章后面提出了一种新的分布式负载均衡算法。其不但能够满足这里提出的要求，而且在分布式上运行，能避免单点故障。
\subsection{数据复制和一致性}
\subsubsection{复制的概述}
在分布式数据库系统中，采用数据复制技术来保证数据的安全。
复制按照交互方式可以分为同步复制和异步复制，在同步复制方式中，主节点需要等待所有副节点的确认以后才能更新数据，
而在异步复制中，主节点收到任何一个节点的确认信息以后就可以更新数据
。在分布式数据库系统中，复制是保证数据安全的手段，但是在分布式系统中，不同的复制副本需要保证一致性，不然数据就是不可用的。在分布式数据库系统中。有几种复制方式来保证数据的一致性。



一种保证数据一致性的方式是主从复制，按照交互方式，主从复制也可以分为同步复制和异步复制两种方式，同步复制更加安全，而异步复制更加高效。
在MYSQL主从架构中，主从数据库服务器之间默认情况下采用异步复制，虽然这种方式在一般情况下，
能够增加性能，减少复制时间，但是也容易引起数据丢失的问题
。比如主节点在没有收到从节点复制完成确认信息的时候就挂掉了，从节点的数据就可能和主节点不一致了。
即便采用了同步复制，数据也不能保证安全
，比如，当主接收写入请求然后发到从节点，从节点写入成
功后并发送确认给主，但是这个时候，主节点正准备发送确
认信息给客户端时主节点挂了，那么客户
端就会认为提交失败，可是这个时候从节点已经提交成功了，如果这个时候从
节点被提升为主，那么就出现问题了，数据不一致了。
在主从复制结构里，异步复制有更好的性能。同步复制则相对更加安全，所以分布式数据库系统中，往往结合这两种复制方式。

在分布式系统中，另一种保证数据一致性的复制方式是引进分布式一致性算法Paxos，
在这种方式中，Paxos算法本身保证了分布式数据库集群中节点之间数据的一致性，现在很多商业分布式数据库
就是采用的这样的方式，但是这样的方式实现困难，容易出现问题。主从复制因为简单部署性，在传统数据库系统中
也得到了广泛的应用。
\subsubsection{一致性和可用性}
在分布式数据库理论中的CAP定理，又被称作布鲁尔定理，有特别重要的作用，
CAP理论认为，在分布式数据库系统中，不可能同时满足以下三个要求：
\begin{enumerate}
	\item 一致性
	\item 可用性
	\item 容忍网络分区
\end{enumerate}
根据CAP理论，任何一个分布式数据库系统都不可能同时满足一致性、可用性和分区容忍性。
在实现分布式数据库系统的时候，一般都要选择实现的功能特性。
因为不可能一个系统满足三个特性。比如，在很多非关系型数据库系统中，抛弃了强一致性，而选择了可用性和分区容忍性。
在关系型数据库中，则必须满足强一致性特性，所以就只能满足可用性和分区容忍性。这也是为什么关系型数据库不能很好的在分布式系统部署的原因。
在分布式数据库系统中，一般选择了减少强一致性要求来实现可用性和分区容忍性。从而使得数据库在分布式环境下能部署。
\subsection{副本和分布式MVCC技术}
\subsubsection{副本的概念}
副本是指在分布式数据库系统中为数据提供的冗余存储，以保证数据的安全性。
因为在分布式数据库集群中，多个数据库节点存储同一份数据，所以在一个节点的数据丢失时，可以从其他分布式数据节点获取副本数据。在分布式系统中，数据副本是保证数据安全性的重要手段。
\subsubsection{副本一致性}
在分布式数据库系统中，通过一定的分布式副本协议或者方法，使得数据库用户在任何情况下操作和读取数据副本，都能保持每个副本数据之间保持相同，称之为副本一致性。副本一致性是保证分布式数据节点之间数据一致性，而不是针对单个数据库节点。
分布式数据库系统为了提高可用性，一定会使用副本的机制，就会引发副本一致性的问题。
\subsubsection{分布式 MVCC}
在数据库系统中，MVCC技术是保证数据一致性和提高数据库更新性能的一种方式。
在这种方式中，用存储空间来换取数据操作性能。
在MVCC技术中，不但存储数据本身，还要保存数据的版本。
在更新数据的时候，更新数据的同时，记录下数据的版本号；
在读取数据的时候，这只读取版本号大于当前更新操作版本号的数据；
删除数据则不真的删除数据，而只是记录下删除版本号。这种方式能够减少不同的事物之间的冲突，
提高高并发情况下数据库系统的更新性能。

分布式MVCC技术则是在分布式数据库中，在多个客户端同时更新数据的时候，保证数据一致性的一种方式。
实现的原理同样基于数据库系统中的MVCC技术。
每个客户端操作都有一个分布式版本号，更新数据的时候除了更新数据，还要保存分布式版本号。
这样多个客户端可以同时更新同一份数据，而不会引起冲突，提高分布式数据系统的性能。
在删除数据的时候，只是简单的记录下删除版本号，当客户端检查到这个删除版本号的时候，
不会检索当前数据给客户端。
\section{本章小结}
本章对数据库系统和分布式数据库系统中的关键技术进行了介绍，这是论文继续研究下去的理论基础，其内容包括：非关系型和关系型数据库系统的概念和区别，数据库系统中事务和并发控制技术，分布式数据库常用的负载均衡算法，分布式数据库系统中的数据一致性和分布式MVCC技术。在常用的负载均衡算法基础之上，论文在实现部分提出了新的分布式负载均衡算法，在分布式相关技术的基础上，论文在后面提出了多主分布式架构。